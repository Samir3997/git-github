package com.maybank.ilm.core.kplusmanager.writers;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import com.maybank.ilm.core.kplusmanager.repo.KPlusFolderRepo;
import com.maybank.ilm.core.util.ILMCoreConstants;
import com.maybank.ilm.kplus.treasury.dto.KPlusProcessedDTO;

@Component
public class FolderWriter implements KPlusFilesWriter{

	private static final Logger LOGGER = LogManager.getLogger(FolderWriter.class);
	
	@Autowired
	KPlusFolderRepo folderRepo;
	
	@Override
	public void writeFilesByType(KPlusProcessedDTO kPlusProcessedDTO) {
		try {
			//folderRepo.updatePrevRecsLatestRecInd();
			folderRepo.save(kPlusProcessedDTO.getkPlusFolder());
		}catch(Exception e){
			LOGGER.info("Error in k plus folder file"+kPlusProcessedDTO.getkPlusFolder());
			LOGGER.error("Exception while writing k plus folder file", e);
		}
	}

	@Override
	public String getFileType() {
		return ILMCoreConstants.FOLDERS;
	}

}



package com.maybank.ilm.junit.kplusmanager.writers;

import static org.mockito.Mockito.when;

import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.List;

import org.junit.Before;
import org.junit.Test;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;

import com.maybank.ilm.core.dao.TreasuryCashflowRepo;
import com.maybank.ilm.core.kplusmanager.repo.KPlusFolderRepo;
import com.maybank.ilm.core.kplusmanager.writers.FolderWriter;
import com.maybank.ilm.entity.TreasuryCashflow;
import com.maybank.ilm.junit.config.AbstractServiceTest;
import com.maybank.ilm.kplus.treasury.dto.KPlusProcessedDTO;
import com.maybank.ilm.kplus.treasury.entity.KPlusBond;
import com.maybank.ilm.kplus.treasury.entity.KPlusFolder;

public class FolderWriterTest extends AbstractServiceTest{
@InjectMocks
FolderWriter folderWriter;
@Mock
KPlusFolderRepo folderRepo;
	
	@Mock
	TreasuryCashflowRepo treasuryCashflowRepo;
	@Before
	public void doSetup() {
		MockitoAnnotations.initMocks(this);
		doSetup(folderWriter);
	}
@Test
public void writeFilesByTypeTest() {
	KPlusProcessedDTO kPlusProcessedDTO= new KPlusProcessedDTO();
	KPlusFolder kPlusFolder= new KPlusFolder();
	List<TreasuryCashflow> kplusTransactions = new ArrayList<>();
	TreasuryCashflow treasuryCashflow= new TreasuryCashflow();
	treasuryCashflow.setCashAmnt(BigDecimal.ZERO);
	kplusTransactions.add(treasuryCashflow);
	kPlusProcessedDTO.setFileType("fileType");
	kPlusProcessedDTO.setkPlusFolder(kPlusFolder);
	kPlusProcessedDTO.setKplusTransactions(kplusTransactions);

	folderWriter.writeFilesByType(kPlusProcessedDTO);
}
@Test
public void writeFilesByTypeTest1() {
	KPlusProcessedDTO kPlusProcessedDTO= new KPlusProcessedDTO();
	KPlusFolder kPlusFolder = new KPlusFolder();
	kPlusProcessedDTO.setkPlusFolder(kPlusFolder);
	when(folderRepo.save(kPlusProcessedDTO.getkPlusFolder())).thenThrow(new NullPointerException());
	folderWriter.writeFilesByType(kPlusProcessedDTO);
}
@Test
public void getFileTypeTest() {
	folderWriter.getFileType();
}
}


@Test
public void writeFilesByTypeTest1() {
    // Arrange
    KPlusProcessedDTO kPlusProcessedDTO = new KPlusProcessedDTO();
    KPlusFolder kPlusFolder = new KPlusFolder();
    kPlusProcessedDTO.setkPlusFolder(kPlusFolder);
    
    // Setup the mock to throw an exception when save() is called
    doThrow(new NullPointerException()).when(folderRepo).save(kPlusFolder);
    
    // Act
    folderWriter.writeFilesByType(kPlusProcessedDTO);
    
    // Assert
    // You can verify that the logger was called with the expected error message
    // This assumes you have a way to verify logger interactions; if not, this step can be skipped
}



@Rule
public TestRule logCaptureRule = new LogCaptureRule();

@Test
public void writeFilesByTypeTest1() {
    // Arrange
    KPlusProcessedDTO kPlusProcessedDTO = new KPlusProcessedDTO();
    KPlusFolder kPlusFolder = new KPlusFolder();
    kPlusProcessedDTO.setkPlusFolder(kPlusFolder);
    
    // Setup the mock to throw an exception when save() is called
    doThrow(new NullPointerException()).when(folderRepo).save(kPlusFolder);
    
    // Act
    folderWriter.writeFilesByType(kPlusProcessedDTO);
    
    // Assert
    // Verify logger output
    assertTrue(logCaptureRule.getLogs().contains("Error in k plus folder file"));
    assertTrue(logCaptureRule.getLogs().contains("Exception while writing k plus folder file"));
}


