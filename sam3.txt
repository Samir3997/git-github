package com.maybank.cac.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.maybank.cac.dao.ComponentRepository;
import com.maybank.cac.dao.PortfolioRepository;
import com.maybank.cac.dto.ComponentDto;

@Service
public class ComponentPortfolioServiceImpl implements ComponentPortfolioService {
    @Autowired
    private ComponentRepository componentRepository;

    @Autowired
    private PortfolioRepository portfolioRepository;

    @Override
    public List<?> getComponentOrPortfolio(String type, String formula) {
        if ("component".equalsIgnoreCase(type)) {
            List<ComponentDto> results = new ArrayList<>();

            // Execute the first query: findComponentByFormula
            List<ComponentDto> componentsByFormula = componentRepository.findComponentByFormula(formula);
            results.addAll(componentsByFormula);

            // Execute the second query: findComponentWithFilterByFormula
            List<ComponentDto> componentsWithFilter = componentRepository.findComponentWithFilterByFormula(formula);
            results.addAll(componentsWithFilter);

            // Execute the third query: findComponentWithHierarchyByFormula
            List<ComponentDto> componentsWithHierarchy = componentRepository.findComponentWithHierarchyByFormula(formula);
            results.addAll(componentsWithHierarchy);

            return results;
        } else if ("portfolio".equalsIgnoreCase(type)) {
            if (formula != null && !formula.isEmpty()) {
                return portfolioRepository.findPortfolioWithMeasures();
            } else {
                return portfolioRepository.findPortfolioWithFilters();
            }
        }
        return null;
    }
}
